{"version":3,"sources":["../src/worldmap_ctrl_apica.js"],"names":["WorldmapCtrlOriginal","$","panelDefaultsApica","locationData","tableLabel","circleMinSize","circleMaxSize","showLegend","stickyLabels","thresholds","colors","editTabIndex","WorldmapCtrl","$scope","$injector","contextSrv","panel","_","assign","cloneDeep","snapshotData","map","setTimeout","render","addEditorTab","pluginId","editTabElementName","find","closest","hide","siblings","text","show","templateUrl"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAOA,0B;;AAEAC,O;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEDC,wB,GAAqB;AACzBC,sBAAc,OADW;AAEzBC,oBAAY,aAFa;AAGzBC,uBAAe,CAHU;AAIzBC,uBAAe,CAJU;AAKzBC,oBAAY,KALa;AAMzBC,sBAAc,IANW;AAOzBC,oBAAY,SAPa;AAQzBC,gBAAQ,CACN,uBADM,EAEN,yBAFM,EAGN,yBAHM,EAIN,0BAJM,EAKN,wBALM;AARiB,O;AAiBrBC,kB,GAAe,C;;AAEAC,kB;;;AAEnB,8BAAYC,MAAZ,EAAoBC,SAApB,EAA+BC,UAA/B,EAA2C;AAAA;;AAAA,kIACnCF,MADmC,EAC3BC,SAD2B,EAChBC,UADgB;;AAGzC;AACA,cAAI,CAAC,MAAKC,KAAL,CAAWZ,UAAhB,EAA4B;AAC1Ba,cAAEC,MAAF,CAAS,MAAKF,KAAd,EAAqBC,EAAEE,SAAF,CAAYjB,kBAAZ,CAArB;AACD;AANwC;AAO1C;;;;6CAEkBkB,Y,EAAc;AAAA;;AAC/B,2IAAyBA,YAAzB;AACA;AACA,gBAAI,CAAC,KAAKC,GAAV,EAAe;AACbC,yBAAW,YAAM;AACf,uBAAKC,MAAL;AACD,eAFD,EAEG,GAFH;AAGD;AACF;;;2CAEgB;AACf;AACA,iBAAKC,YAAL,CAAkB,UAAlB,sBAAgD,KAAKC,QAArD,4BAAsFd,YAAtF;AACD;;;qCAEU;AACT,gBAAIe,2CAAyC,KAAKD,QAA9C,GAAyDd,YAA7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAV,qCAAuByB,kBAAvB,EACGC,IADH,sUAQKC,OARL,CAQa,UARb,EAQyBC,IARzB;;AAUA;AACA;AACA;AACA5B,qCAAuByB,kBAAvB,EACGC,IADH,uHAIKC,OAJL,CAIa,gBAJb,EAI+BC,IAJ/B;;AAMA5B,qCAAuByB,kBAAvB,kDAAwFI,QAAxF,CAAiG,gBAAjG,EAAmHC,IAAnH,CAAwH,aAAxH;;AAEA;AACA9B,qCAAuByB,kBAAvB,mBAAyDM,IAAzD;AACD;;;mCAEQ;AACP;AACA,iBAAKhB,KAAL,CAAWV,aAAX,GAA2B,KAAKU,KAAL,CAAWX,aAAtC;AACA;AACD;;;;QAhEuCL,oB;;yBAArBY,Y;;AAmErB;AACA;AACA;AACA;AACAA,mBAAaqB,WAAb,GAA2B,gDAA3B","file":"worldmap_ctrl_apica.js","sourcesContent":["import WorldmapCtrlOriginal from './worldmap_ctrl';\n\nimport $ from 'jquery';\n\nconst panelDefaultsApica = {\n  locationData: 'table',\n  tableLabel: 'summaryHtml',\n  circleMinSize: 5,\n  circleMaxSize: 5,\n  showLegend: false,\n  stickyLabels: true,\n  thresholds: '1,2,3,4',\n  colors: [\n    'rgba(90, 98, 90, 0.9)',\n    'rgba(50, 172, 45, 0.97)',\n    'rgba(224, 210, 0, 0.97)',\n    'rgba(237, 129, 40, 0.89)',\n    'rgba(245, 54, 54, 0.9)'\n  ]\n};\n\nconst editTabIndex = 2;\n\nexport default class WorldmapCtrl extends WorldmapCtrlOriginal {\n\n  constructor($scope, $injector, contextSrv) {\n    super($scope, $injector, contextSrv);\n\n    // tableLabel is not initiated in parent by default, so this is the mark that here we should init Apica checks summary by location format. \n    if (!this.panel.tableLabel) {\n      _.assign(this.panel, _.cloneDeep(panelDefaultsApica));\n    }\n  }\n\n  onDataSnapshotLoad(snapshotData) {\n    super.onDataSnapshotLoad(snapshotData);\n    // a hack to make sure that map is initialized (it doesn't happen in time when work in snapshot mode) \n    if (!this.map) {\n      setTimeout(() => {\n        this.render();\n      }, 100);\n    }\n  }\n\n  onInitEditMode() {\n    // tab will be added as a tag with name 'panel-editor-tab-{pluginId}{editTabIndex}', for example: <panel-editor-tab-apica-worldmap-panel2> \n    this.addEditorTab('Worldmap', `public/plugins/${this.pluginId}/partials/editor.html`, editTabIndex);\n  }\n\n  initCtrl() {\n    let editTabElementName = `panel-editor-tab-${this.pluginId}${editTabIndex}`;\n    // hide not useless Map Visual Options:\n    // - Max Circle Size - circle sizes should be the same for now\n    // - Decimals - metric is used for the color, so decimals settings is useless\n    // - Unit - same as Decimals\n    // - Show Legend - legend shows metric values, but they as color codes are useless\n    // - Location Data - should always be 'table' (ASM Datasource provides data in table format)\n    // - Aggregation - not used, 'metric' property from data source is always used\n    $(`.tabbed-view-body ${editTabElementName}`)\n      .find(`\n        input[ng-model=\"ctrl.panel.circleMaxSize\"],\n        input[ng-model=\"ctrl.panel.decimals\"],\n        input[ng-model=\"ctrl.panel.unitSingular\"],\n        gf-form-switch[checked=\"ctrl.panel.showLegend\"],\n        select[ng-model=\"ctrl.panel.locationData\"],\n        select[ng-model=\"ctrl.panel.valueName\"]\n      `).closest('.gf-form').hide();\n\n    // hide not useless Map Visual Options:\n    // - Threshold Options (Thresholds, Colors) - thresholds are used for circles coloring that \n    // - Hide series (With only nulls, With only zeros)\n    $(`.tabbed-view-body ${editTabElementName}`)\n      .find(`\n        input[ng-model=\"ctrl.panel.thresholds\"],\n        gf-form-switch[checked=\"ctrl.panel.hideEmpty\"]\n      `).closest('.gf-form-group').hide();\n    \n    $(`.tabbed-view-body ${editTabElementName} input[ng-model=\"ctrl.panel.circleMinSize\"]`).siblings('.gf-form-label').text('Circle Size');\n    \n    // Editor is hidden by default. Make it visible.\n    $(`.tabbed-view-body ${editTabElementName} .editor-row`).show();\n  }\n  \n  render() {\n    // different circle sizes in current implementation has no sence, so we adjust them to be equal.\n    this.panel.circleMaxSize = this.panel.circleMinSize;\n    super.render();\n  }\n}\n\n// note that plugin id (apica-worldmap-panel) is hardcoded here as templateUrl is static\n// it isn't clear how to avoid hardcode (like it was done in the constructor using $scope.ctrl.pluginId)\n// from grafana hosting all plugins will be available from linear structure, no matter how they actually added into physical plugins folder.\n// this way ('../../plugins/pluginid/resource) we make sure plugin will work even if it's included in an app plugin sub-folder.  \nWorldmapCtrl.templateUrl = '../../plugins/apica-worldmap-panel/module.html';"]}